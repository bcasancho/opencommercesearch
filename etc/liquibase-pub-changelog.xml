<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
     xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd"
     logicalFilePath="./../script/liquibase/liquibase-pub-changelog.xml">

    <!-- changesets to run against the atg_pub (publishing) schema -->

	  <changeSet author="kkhaliqi" id="2">
       <addColumn tableName="bc_category">
            <column name="featured_brand_info_id" type="varchar2(40)"/>
        </addColumn>
     </changeSet>
     
    <changeSet author="schen" id="11">
 		<addColumn tableName="bc_category">
			<column name="rule_promo_type" type="NUMBER"/>
 		</addColumn>
 	</changeSet>
 	
 	<!-- update the existing rule cateory type to "rule based" -->
 	<changeSet author="schen" id="12">
 		<sql>
 		update bc_category set rule_promo_type=1 where category_id in (select category_id from dcs_category where category_type=1);
 		</sql>
 	</changeSet>

  <changeSet author="mmonge" id="10">
    <preConditions onFail="MARK_RAN">
      <not><columnExists tableName="bc_category" columnName="custom_page_title_tag"/></not>
      <not><columnExists tableName="bc_category" columnName="custom_page_h1_heading"/></not>
      <not><columnExists tableName="bc_category" columnName="custom_page_meta_description"/></not>
      <not><columnExists tableName="bc_brand_info" columnName="custom_page_title_tag"/></not>
      <not><columnExists tableName="bc_brand_info" columnName="custom_page_h1_heading"/></not>
      <not><columnExists tableName="bc_brand_info" columnName="custom_page_meta_description"/></not>
    </preConditions>
    <comment>
      FSD-3564 Add new fields to manage H1 title, page title tag, page meta description and menu on
      Category and Brand pages. A clean up changeSet will follow this one removing the columns
      (web_display_name, meta_description, h1_title, short_display_name) used currently for those purposes.
    </comment>
    <addColumn tableName="bc_category">
      <column name="custom_short_display_name" type="varchar2(40)"/>
      <column name="custom_page_title_tag" type="varchar2(512)"/>
      <column name="custom_page_h1_heading" type="varchar2(100)"/>
      <column name="custom_page_meta_description" type="varchar2(512)"/>
    </addColumn>
    <addColumn tableName="bc_brand_info">
      <column name="display_name" type="varchar2(64)"/>
      <column name="custom_page_title_tag" type="varchar2(512)"/>
      <column name="custom_page_h1_heading" type="varchar2(100)"/>
      <column name="custom_page_meta_description" type="varchar2(512)"/>
    </addColumn>
    <sql>
      update bc_category
      set custom_short_display_name = short_display_name,
      custom_page_title_tag = web_display_name,
      custom_page_h1_heading = h1_title,
      custom_page_meta_description = meta_description
    </sql>
    <sql>
      update bc_brand_info
      set custom_page_title_tag = web_display_name,
      custom_page_h1_heading = h1_title,
      custom_page_meta_description = meta_description
    </sql>
    <sql>
      update bc_brand_info
      set bc_brand_info.display_name = (select bc_brand.display_name
      from bc_brand
      where bc_brand_info.brand_id = bc_brand.brand_id)
    </sql>
  </changeSet>
  
  <changeSet author="aglemann" id="1">
      <preConditions onFail="MARK_RAN">
          <sqlCheck expectedResult="0">
              select count(*) from bc_feature where name = 'redesignNavFlyout'
          </sqlCheck>
      </preConditions>
      <insert tableName="bc_feature">
          <column name="name" value="redesignNavFlyout" />
          <column name="enabled" value="0" />
      </insert>
  </changeSet>
  
 	    <changeSet author="kkhaliqi" id="3">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="bc_payment_txn_gateway"/></not>
        </preConditions>
        <comment>
            bc_payment_txn_gateway stores cybersource transaction data for tax, cc, bml, and paypal
        </comment>
        <createTable tableName="bc_payment_txn_gateway">
            <column name="id" type="VARCHAR2(40)">
                 <constraints nullable="false" />
            </column>
            <column name="txn_date" type="timestamp">
                 <constraints nullable="true" />
            </column>
            <column name="txn_type" type="VARCHAR2(255)">
                 <constraints nullable="true" />
            </column>
            <column name="merchant_ref_code" type="VARCHAR2(40)">
                 <constraints nullable="true" />
            </column>
            <column name="custom_field1" type="VARCHAR2(255)">
                 <constraints nullable="true" />
            </column>
            <column name="decision" type="VARCHAR2(40)">
                 <constraints nullable="true" />
            </column>                                 
            <column name="reason_code" type="VARCHAR2(20)">
                 <constraints nullable="true" />
            </column>  
            <column name="gpn_code" type="VARCHAR2(10)">
                 <constraints nullable="true" />
            </column>              
            <column name="server_name" type="VARCHAR2(512)">
                 <constraints nullable="true" />
            </column>   
            <column name="req_xml" type="CLOB">
                 <constraints nullable="true" />
            </column> 
            <column name="res_xml" type="CLOB">
                 <constraints nullable="true" />
            </column>             
        </createTable>        
        <addPrimaryKey tableName="bc_payment_txn_gateway" columnNames="id" constraintName="bc_payment_txn_gateway_pk" />
    </changeSet>
    
    <changeSet author="jcordero" id="24">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="bc_content"/>
            <not><columnExists tableName="bc_content" columnName="admin_display"/></not>
        </preConditions> 
        <addColumn tableName="bc_content">
          <column name="admin_display" type="VARCHAR2(254)"/>
        </addColumn>
    </changeSet>
    
    <changeSet author="jcordero" id="25">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="bc_brand_category"/>
            <not><columnExists tableName="bc_brand_category" columnName="has_stock"/></not>
        </preConditions> 
        <addColumn tableName="bc_brand_category">
              <column name="has_stock" type="NUMBER(1,0)" defaultValue="1"/>
            </addColumn>
    </changeSet>
 
    <changeSet author="eharrison" id="1">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="bc_url_mapping"/></not>
            <not><tableExists tableName="bc_url_mapping_sites"/></not>
        </preConditions>

        <createTable tableName="bc_url_mapping">
            <column name="url_mapping_id" type="VARCHAR2(40)">
                <constraints nullable="false"/>
            </column>             
             
            <column name="type" type="VARCHAR2(10 BYTE)">
                <constraints nullable="false" />
            </column>

            <column name="source_path" type="VARCHAR2(1024 BYTE)">
                <constraints nullable="false" />
            </column>
             
            <column name="destination_path" type="VARCHAR2(1024 BYTE)">
                <constraints nullable="true" />
            </column>
            
            <column name="asset_version" type="NUMBER(19)">
                <constraints nullable="false"/>
            </column>
            <column name="workspace_id" type="VARCHAR2(40)">
                <constraints nullable="false"/>
            </column>
            <column name="branch_id" type="VARCHAR2(40)">
                <constraints nullable="false"/>
            </column>
            <column name="is_head" type="NUMBER(1)">
                <constraints nullable="false"/>
            </column>
            <column name="version_deleted" type="NUMBER(1)">
                <constraints nullable="false"/>
            </column>
            <column name="version_editable" type="NUMBER(1)">
                <constraints nullable="false"/>
            </column>
            <column name="pred_version" type="NUMBER(19)"/>
            <column name="checkin_date" type="TIMESTAMP"/>                        
        </createTable>
        
        <addPrimaryKey tableName="bc_url_mapping" columnNames="url_mapping_id, asset_version" constraintName="bc_url_mapping_pk"/>
        
        <createTable tableName="bc_url_mapping_sites">
            <column name="url_mapping_id" type="VARCHAR2(40)">
                <constraints nullable="false" />
            </column>

            <column name="site_id" type="VARCHAR2(40)">
                <constraints nullable="false"/>
            </column>
            <column name="asset_version" type="NUMBER(19)">
                <constraints nullable="false"/>
            </column>
        </createTable>        
        
        <addPrimaryKey tableName="bc_url_mapping_sites" columnNames="url_mapping_id, site_id, asset_version" constraintName="bc_url_mapping_sites_pk"/>
                              
    </changeSet>
 
    <changeSet author="gsegura" id="20">
        <sql>
            update vmap_attrval set attr_value = 'creationDate,itemAcl,parentCategoryForCatalog,ancestorCategoryIds' where id = 'AmAvCatAdvExc';
        </sql>
    </changeSet>

    <changeSet author="bbergendahl" id="3000">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="bc_shipping_method_names" columnName="method_name"/>
        </preConditions>
        <modifyDataType tableName="bc_shipping_method_names" columnName="method_name" newDataType="VARCHAR2(50)"/>
    </changeSet>
    
    <changeSet author="jcordero" id="26">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="bc_shipping_methods"/>
            <not><columnExists tableName="bc_shipping_methods" columnName="method_velocity_sort_pos"/></not>
        </preConditions> 
        <addColumn tableName="bc_shipping_methods">
            <column name="method_velocity_sort_pos" type="numeric(2,0)"/>
        </addColumn>
    </changeSet>

    <changeSet author="jcordero" id="27">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="bc_shipping_methods"/>
            <not><columnExists tableName="bc_shipping_methods" columnName="method_custom_sort_pos"/></not>
        </preConditions> 
        <addColumn tableName="bc_shipping_methods">
            <column name="method_custom_sort_pos" type="numeric(2,0)"/>
        </addColumn>
    </changeSet>

    <changeSet author="jcordero" id="30">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="bc_promo_content_deli_prom"/></not>
        </preConditions> 
        <createTable tableName="bc_promo_content_deli_prom">
              <column name="content_id" type="VARCHAR2(40 BYTE)">
                <constraints  nullable="false" />
              </column>               
              <column name="targeted_ship_method_id" type="VARCHAR2(40 BYTE)">
                <constraints  nullable="false"/>
              </column>
              <column name="asset_version" type="NUMBER(19)">
                <constraints nullable="false"/>
              </column>
        </createTable>
        <addPrimaryKey tableName="bc_promo_content_deli_prom" columnNames="content_id,asset_version" constraintName="bc_pro_con_deli_prom_pk"/>
    </changeSet>

    <changeSet author="jcordero" id="31">
    <preConditions onFail="MARK_RAN">
        <not><tableExists tableName="bc_delivery_promise_exc_cat"/></not>
    </preConditions> 
    <createTable tableName="bc_delivery_promise_exc_cat">
          <column name="content_id" type="VARCHAR2(40 BYTE)">
            <constraints  nullable="false"/>
          </column>               
          <column name="excluded_cat_id" type="VARCHAR2(40 BYTE)">
            <constraints  nullable="false"/>
          </column>
          <column name="asset_version" type="NUMBER(19)">
            <constraints nullable="false"/>
          </column>
    </createTable>
    <addPrimaryKey tableName="bc_delivery_promise_exc_cat" columnNames="content_id,excluded_cat_id,asset_version" constraintName="bc_delivery_promise_exc_cat_pk"/>
</changeSet>

    <changeSet author="kkhaliqi" id="10">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="bc_cat_xlate"/></not>
            <not><tableExists tableName="bc_cat_cat_xlate"/></not>
        </preConditions> 
        <sql>
		create table bc_cat_xlate (
			asset_version	number(19)	not null,
			workspace_id	varchar2(40)	not null,
			branch_id	varchar2(40)	not null,
			is_head	number(1)	not null,
			version_deleted	number(1)	not null,
			version_editable	number(1)	not null,
			pred_version	number(19)	null,
			checkin_date	date	null,
			translation_id	varchar2(40)	not null,
			display_name	varchar2(254)	null,
			description	varchar2(254)	null,
			long_description	varchar2(4000)	null,
			custom_short_display_name	varchar2(254)	null,
			custom_page_title_tag varchar2(512),
			custom_page_h1_heading varchar2(100),
			custom_page_meta_description varchar2(512)
		,constraint bc_cat_xlate_p primary key (translation_id,asset_version));        
		create index bc_cat_xlate_wsx on bc_cat_xlate (workspace_id);
		create index bc_cat_xlate_cix on bc_cat_xlate (checkin_date) 
        </sql>
        <sql>
			 create table bc_cat_cat_xlate (
				asset_version	number(19)	not null,
				category_id	varchar2(40)	not null,
				locale	varchar2(40)	not null,
				translation_id	varchar2(40)	not null
			,constraint bc_cat_cat_xlt_p primary key (category_id,locale,asset_version));
			
			create index bc_cat_xlt_tr_id on bc_cat_cat_xlate (translation_id);     
        </sql>
   </changeSet>
   
    <changeSet author="kkhaliqi" id="11">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="bc_prd_xlate"/></not>
            <not><tableExists tableName="bc_prd_prd_xlate"/></not>
        </preConditions> 
        <sql>
			create table bc_prd_xlate (
				asset_version	number(19)	not null,
				workspace_id	varchar2(40)	not null,
				branch_id	varchar2(40)	not null,
				is_head	number(1)	not null,
				version_deleted	number(1)	not null,
				version_editable	number(1)	not null,
				pred_version	number(19)	null,
				checkin_date	date	null,
				translation_id	varchar2(40)	not null,
				display_name	varchar2(254)	null,
				description	varchar2(254)	null,
				long_description	varchar2(4000)	null,
				bottom_line	clob	null
			,constraint bc_prd_xlate_p primary key (translation_id,asset_version));
			
			create index bc_prd_xlate_wsx on bc_prd_xlate (workspace_id);
			create index bc_prd_xlate_cix on bc_prd_xlate (checkin_date)
        </sql>
        <sql>
			create table bc_prd_prd_xlate (
				asset_version	number(19)	not null,
				product_id	varchar2(40)	not null,
				locale	varchar2(40)	not null,
				translation_id	varchar2(40)	not null
			,constraint bc_prd_prd_xlt_p primary key (product_id,locale,asset_version));
			
			create index bc_prd_xlt_tr_id on bc_prd_prd_xlate (translation_id);    
        </sql>
   </changeSet>   
    <changeSet author="kkhaliqi" id="12">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="bc_sku_xlate"/></not>
            <not><tableExists tableName="bc_sku_sku_xlate"/></not>
        </preConditions> 
        <sql>
			create table bc_sku_xlate (
				asset_version	number(19)	not null,
				workspace_id	varchar2(40)	not null,
				branch_id	varchar2(40)	not null,
				is_head	number(1)	not null,
				version_deleted	number(1)	not null,
				version_editable	number(1)	not null,
				pred_version	number(19)	null,
				checkin_date	date	null,
				translation_id	varchar2(40)	not null,
				display_name	varchar2(254)	null,
				description	varchar2(254)	null,
				color			varchar2(254)	null,
				color_family	varchar2(254)	null
			,constraint bc_sku_xlate_p primary key (translation_id,asset_version));
			
			create index bc_sku_xlate_wsx on bc_sku_xlate (workspace_id);
			create index bc_sku_xlate_cix on bc_sku_xlate (checkin_date)
        </sql>
        <sql>
			create table bc_sku_sku_xlate (
				asset_version	number(19)	not null,
				sku_id	varchar2(40)	not null,
				locale	varchar2(40)	not null,
				translation_id	varchar2(40)	not null
			,constraint bc_sku_sku_xlt_p primary key (sku_id,locale,asset_version));
			
			create index bc_sku_xlt_tr_id on bc_sku_sku_xlate (translation_id);    
        </sql>
   </changeSet>   
   
   <changeSet author="kkhaliqi" id="13">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="bc_binfo_xlate"/></not>
            <not><tableExists tableName="bc_binfo_binfo_xlate"/></not>
        </preConditions> 
        <sql>
		create table bc_binfo_xlate (
			asset_version	number(19)	not null,
			workspace_id	varchar2(40)	not null,
			branch_id	varchar2(40)	not null,
			is_head	number(1)	not null,
			version_deleted	number(1)	not null,
			version_editable	number(1)	not null,
			pred_version	number(19)	null,
			checkin_date	date	null,
			translation_id	varchar2(40)	not null,			
			description	clob	null,
			custom_page_meta_description varchar2(512)
		,constraint bc_binfo_xlate_p primary key (translation_id,asset_version));        
		create index bc_binfo_xlate_wsx on bc_binfo_xlate (workspace_id);
		create index bc_binfo_xlate_cix on bc_binfo_xlate (checkin_date) 
        </sql>
        <sql>
			 create table bc_binfo_binfo_xlate (
				asset_version	number(19)	not null,
				brand_info_id	varchar2(40)	not null,
				locale	varchar2(40)	not null,
				translation_id	varchar2(40)	not null
			,constraint bc_binfo_binfo_xlt_p primary key (brand_info_id,locale,asset_version));
			
			create index bc_binfo_xlt_tr_id on bc_binfo_binfo_xlate (translation_id);     
        </sql>
   </changeSet> 

    <changeSet author="kkhaliqi" id="14">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="bc_promcnt_xlate"/></not>
            <not><tableExists tableName="bc_promcnt_promcnt_xlate"/></not>
        </preConditions> 
        <sql>
		create table bc_promcnt_xlate (
			asset_version	number(19)	not null,
			workspace_id	varchar2(40)	not null,
			branch_id	varchar2(40)	not null,
			is_head	number(1)	not null,
			version_deleted	number(1)	not null,
			version_editable	number(1)	not null,
			pred_version	number(19)	null,
			checkin_date	date	null,
			translation_id	varchar2(40)	not null,
			display_name	varchar2(254)	null,
			description	varchar2(254)	null,
			long_description	clob	null,
			link_text	varchar2(254)	null
		,constraint bc_promcnt_xlate_p primary key (translation_id,asset_version));        
		create index bc_promcnt_xlate_wsx on bc_promcnt_xlate (workspace_id);
		create index bc_promcnt_xlate_cix on bc_promcnt_xlate (checkin_date) 
        </sql>
        <sql>
			 create table bc_promcnt_promcnt_xlate (
				asset_version	number(19)	not null,
				promo_content_id	varchar2(40)	not null,
				locale	varchar2(40)	not null,
				translation_id	varchar2(40)	not null
			,constraint bc_promcnt_promcnt_xlt_p primary key (promo_content_id,locale,asset_version));
			
			create index bc_promcnt_xlt_tr_id on bc_promcnt_promcnt_xlate (translation_id);     
        </sql>
   </changeSet>    
    <changeSet author="kkhaliqi" id="15">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="bc_content_xlate"/></not>
            <not><tableExists tableName="bc_cont_cont_xlate"/></not>
        </preConditions> 
        <sql>
		create table bc_content_xlate (
			asset_version	number(19)	not null,
			workspace_id	varchar2(40)	not null,
			branch_id	varchar2(40)	not null,
			is_head	number(1)	not null,
			version_deleted	number(1)	not null,
			version_editable	number(1)	not null,
			pred_version	number(19)	null,
			checkin_date	date	null,
			translation_id	varchar2(40)	not null,
			display_name	varchar2(254)	null,
			description	clob	null,
			meta_description				varchar2(512)	null
		,constraint bc_content_xlate_p primary key (translation_id,asset_version));        
		create index bc_content_xlate_wsx on bc_content_xlate (workspace_id);
		create index bc_content_xlate_cix on bc_content_xlate (checkin_date) 
        </sql>
        <sql>
			 create table bc_cont_cont_xlate (
				asset_version	number(19)	not null,
				content_id	varchar2(40)	not null,
				locale	varchar2(40)	not null,
				translation_id	varchar2(40)	not null
			,constraint bc_cont_cont_xlt_p primary key (content_id,locale,asset_version));
			
			create index bc_content_xlt_tr_id on bc_cont_cont_xlate (translation_id);     
        </sql>
   </changeSet>   
   <!-- move message key table to catalog schema -->
    <changeSet author="kkhaliqi" id="16">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="BC_MESSAGE_KEY" />
        </preConditions>
        <dropTable tableName="BC_MESSAGE_KEY"/>
    </changeSet>

    <!-- create message key table -->
    <changeSet author="kkhaliqi" id="17">
        <createTable tableName="BC_MESSAGE">
            <column name="asset_version" type="VARCHAR(19)">
                <constraints nullable="false" />
            </column>
            <column name="workspace_id" type="VARCHAR(40)">
                <constraints nullable="false" />
            </column>
            <column name="branch_id" type="VARCHAR(40)">
                <constraints nullable="false" />
            </column>
            <column name="is_head" type="number(1)">
                <constraints nullable="false" />
            </column>
            <column name="version_deleted" type="number(1)">
                <constraints nullable="false" />
            </column>
            <column name="version_editable" type="number(1)">
                <constraints nullable="false" />
            </column>
            <column name="pred_version" type="NUMBER(19)" />
            <column name="checkin_date" type="DATE" />
            <column name="ID" type="VARCHAR(40)">
                <constraints nullable="false"/>
            </column>
            <column name="MESSAGE_KEY" type="VARCHAR2(1024)">
                <constraints nullable="false"/>
            </column>
            <column name="SITE_ID" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="TYPE" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="MESSAGE_VALUE" type="VARCHAR2(4000)">
                <constraints nullable="false"/>
            </column>
        </createTable>
            <sql>
            	create index bc_message_key_idx on bc_message (message_key);
            	create index bc_message_site_id_idx on bc_message (site_id);
 				create index bc_message_wsx on bc_message (workspace_id);
				create index bc_message_cix on bc_message (checkin_date);           	
            </sql>
        <addPrimaryKey tableName="BC_MESSAGE" columnNames="id,asset_version" constraintName="BC_MESSAGE_KEY_P"/>
    </changeSet> 
    <changeSet author="kkhaliqi" id="18">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="bc_message_xlate"/></not>
            <not><tableExists tableName="bc_message_message_xlate"/></not>
        </preConditions> 
        <sql>
		create table bc_message_xlate (
			asset_version	number(19)	not null,
			workspace_id	varchar2(40)	not null,
			branch_id	varchar2(40)	not null,
			is_head	number(1)	not null,
			version_deleted	number(1)	not null,
			version_editable	number(1)	not null,
			pred_version	number(19)	null,
			checkin_date	date	null,
			translation_id	varchar2(40)	not null,
			message_value	varchar2(254)	not null
		,constraint bc_message_xlate_p primary key (translation_id,asset_version));        
		create index bc_message_xlate_wsx on bc_message_xlate (workspace_id);
		create index bc_message_xlate_cix on bc_message_xlate (checkin_date) 
        </sql>
        <sql>
			 create table bc_message_message_xlate (
				asset_version	number(19)	not null,
				message_id	varchar2(40)	not null,
				locale	varchar2(40)	not null,
				translation_id	varchar2(40)	not null
			,constraint bc_message_message_xlt_p primary key (message_id,locale,asset_version));
			
			create index bc_message_xlt_tr_id on bc_message_message_xlate (translation_id);     
        </sql>
   </changeSet>        

    <changeSet author="kkhaliqi" id="19">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="bc_techspec_xlate"/></not>
            <not><tableExists tableName="bc_techspec_techspec_xlate"/></not>
        </preConditions> 
        <sql>
		create table bc_techspec_xlate (
			asset_version	number(19)	not null,
			workspace_id	varchar2(40)	not null,
			branch_id	varchar2(40)	not null,
			is_head	number(1)	not null,
			version_deleted	number(1)	not null,
			version_editable	number(1)	not null,
			pred_version	number(19)	null,
			checkin_date	date	null,
			translation_id	varchar2(40)	not null,
			label	varchar(255) null,
			value	varchar2(4000)  null
		,constraint bc_techspec_xlate_p primary key (translation_id,asset_version));        
		create index bc_techspec_xlate_wsx on bc_techspec_xlate (workspace_id);
		create index bc_techspec_xlate_cix on bc_techspec_xlate (checkin_date) 
        </sql>
        <sql>
			 create table bc_techspec_techspec_xlate (
				asset_version	number(19)	not null,
				tech_spec_id	varchar2(40)	not null,
				locale	varchar2(40)	not null,
				translation_id	varchar2(40)	not null
			,constraint bc_techspec_techspec_xlt_p primary key (tech_spec_id,locale,asset_version));
			
			create index bc_techspec_xlt_tr_id on bc_techspec_techspec_xlate (translation_id);     
        </sql>
   </changeSet> 

    <changeSet author="kkhaliqi" id="20">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="BC_SITE_LOCALE"/></not>
        </preConditions>
       <createTable tableName="BC_SITE_LOCALE">
            <column name="asset_version" type="VARCHAR(19)">
                <constraints nullable="false" />
            </column>
            <column name="workspace_id" type="VARCHAR(40)">
                <constraints nullable="false" />
            </column>
            <column name="branch_id" type="VARCHAR(40)">
                <constraints nullable="false" />
            </column>
            <column name="is_head" type="number(1)">
                <constraints nullable="false" />
            </column>
            <column name="version_deleted" type="number(1)">
                <constraints nullable="false" />
            </column>
            <column name="version_editable" type="number(1)">
                <constraints nullable="false" />
            </column>
            <column name="pred_version" type="NUMBER(19)" />
            <column name="checkin_date" type="DATE" />
            <column name="LOCALE_ID" type="VARCHAR(40)">
                <constraints nullable="false"/>
            </column>
            <column name="LOCALE" type="VARCHAR2(40)">
                <constraints nullable="true"/>
            </column>
        </createTable>
            <sql>
 				create index BC_SITE_LOCALE_WSX on BC_SITE_LOCALE (workspace_id);
				create index BC_SITE_LOCALE_CIX on BC_SITE_LOCALE (checkin_date);           	
            </sql>
        <addPrimaryKey tableName="BC_SITE_LOCALE" columnNames="locale_id,asset_version" constraintName="BC_SITE_LOCALE_P"/>
    </changeSet>
    
     <changeSet author="kkhaliqi" id="21">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="BC_SITE_SITE_LOCALE"/></not>
        </preConditions>
       <createTable tableName="BC_SITE_SITE_LOCALE">
            <column name="asset_version" type="VARCHAR(19)">
                <constraints nullable="false" />
            </column>
            <column name="SITE_ID" type="VARCHAR2(40)">
                <constraints nullable="false"/>
            </column>
            <column name="LOCALE_ID" type="VARCHAR2(40)">
                <constraints nullable="false"/>
            </column>
        </createTable>
		<addPrimaryKey tableName="BC_SITE_SITE_LOCALE"
			columnNames="SITE_ID,LOCALE_ID,ASSET_VERSION" constraintName="BC_SITE_SITE_LOCALE_PK" /> 
        <sql>
        	create index bc_site_site_locale_idx on BC_SITE_SITE_LOCALE (LOCALE_ID);  
        </sql>
    </changeSet>

    <changeSet author="kkhaliqi" id="22">
        <preConditions onFail="MARK_RAN">
          <tableExists tableName="bc_prd_prd_xlate" />
          <tableExists tableName="bc_prd_xlate" />
          <tableExists tableName="bc_sku_sku_xlate" />
          <tableExists tableName="bc_sku_xlate" />
          <tableExists tableName="bc_techspec_techspec_xlate" />
          <tableExists tableName="bc_techspec_xlate" />
        </preConditions>
        <dropTable tableName="bc_prd_prd_xlate"/>
        <dropTable tableName="bc_prd_xlate"/>
        <dropTable tableName="bc_sku_sku_xlate"/>
        <dropTable tableName="bc_sku_xlate"/>
        <dropTable tableName="bc_techspec_techspec_xlate"/>
        <dropTable tableName="bc_techspec_xlate"/>
    </changeSet>


    <changeSet author="kkhaliqi" id="23">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="bc_promo_content" columnName="description"/>
        </preConditions>
        <modifyDataType tableName="bc_promo_content" columnName="description" newDataType="VARCHAR2(1000)"/>
    </changeSet>	

     <changeSet author="kkhaliqi" id="28">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="BC_CAT_LOCALE"/></not>
        </preConditions>
       <createTable tableName="BC_CAT_LOCALE">
            <column name="LOCALE_ID" type="VARCHAR2(40)">
                <constraints nullable="false"/>
            </column> 
             <column name="LOCALE" type="VARCHAR2(40)">
                <constraints nullable="false"/>
            </column>
           <column name="asset_version" type="VARCHAR(19)">
                <constraints nullable="false" />
            </column>
            <column name="workspace_id" type="VARCHAR(40)">
                <constraints nullable="false" />
            </column>
            <column name="branch_id" type="VARCHAR(40)">
                <constraints nullable="false" />
            </column>
            <column name="is_head" type="number(1)">
                <constraints nullable="false" />
            </column>
            <column name="version_deleted" type="number(1)">
                <constraints nullable="false" />
            </column>
            <column name="version_editable" type="number(1)">
                <constraints nullable="false" />
            </column>
            <column name="pred_version" type="NUMBER(19)" />
            <column name="checkin_date" type="DATE" />
	       </createTable>
		<addPrimaryKey tableName="BC_CAT_LOCALE"
			columnNames="LOCALE_ID" constraintName="BC_CAT_LOCALE_PK" /> 
            <sql>
 				create index BC_CAT_LOCALE_WSX on BC_CAT_LOCALE (workspace_id);
				create index BC_CAT_LOCALEe_CIX on BC_CAT_LOCALE (checkin_date);           	
            </sql>	
	</changeSet>
     <changeSet author="kkhaliqi" id="29">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="BC_CAT_EXCLUDED_LOCALE"/></not>
        </preConditions>
       <createTable tableName="BC_CAT_EXCLUDED_LOCALE">
       	   <column name="ASSET_VERSION" type="NUMBER(19)">
       	   	<constraints nullable="false"/>
       	   </column>
            <column name="CATEGORY_ID" type="VARCHAR2(40)">
                <constraints nullable="false"/>
            </column>
            <column name="LOCALE_ID" type="VARCHAR2(40)">
                <constraints nullable="false"/>
            </column>
        </createTable>
		<addPrimaryKey tableName="BC_CAT_EXCLUDED_LOCALE"
			columnNames="CATEGORY_ID,LOCALE_ID,ASSET_VERSION" constraintName="BC_CAT_EXCLUDED_LOCALE_PK" /> 
     </changeSet>
    	
     <changeSet author="kkhaliqi" id="30">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="BC_CAT_LOCALE"/>
        </preConditions>
        <dropTable tableName="BC_CAT_LOCALE" cascadeConstraints="true"/>	
	</changeSet>
     <changeSet author="kkhaliqi" id="31">
        <preConditions onFail="MARK_RAN">
            <not><tableExists tableName="BC_VERSIONED_LOCALE"/></not>
        </preConditions>
       <createTable tableName="BC_VERSIONED_LOCALE">
            <column name="LOCALE_ID" type="VARCHAR2(40)">
                <constraints nullable="false"/>
            </column> 
             <column name="LOCALE" type="VARCHAR2(40)">
                <constraints nullable="false"/>
            </column>
           <column name="asset_version" type="VARCHAR(19)">
                <constraints nullable="false" />
            </column>
            <column name="workspace_id" type="VARCHAR(40)">
                <constraints nullable="false" />
            </column>
            <column name="branch_id" type="VARCHAR(40)">
                <constraints nullable="false" />
            </column>
            <column name="is_head" type="number(1)">
                <constraints nullable="false" />
            </column>
            <column name="version_deleted" type="number(1)">
                <constraints nullable="false" />
            </column>
            <column name="version_editable" type="number(1)">
                <constraints nullable="false" />
            </column>
            <column name="pred_version" type="NUMBER(19)" />
            <column name="checkin_date" type="DATE" />
	       </createTable>
		<addPrimaryKey tableName="BC_VERSIONED_LOCALE"
			columnNames="LOCALE_ID" constraintName="BC_VERSIONED_LOCALE_PK" /> 
            <sql>
 				create index BC_VERSIONED_LOCALE_WSX on BC_VERSIONED_LOCALE (workspace_id);
				create index BC_VERSIONED_LOCALE_CIX on BC_VERSIONED_LOCALE (checkin_date);           	
            </sql>	
	</changeSet>

    
  	<changeSet author="schen" id="13">
       <addColumn tableName="bc_binfo_xlate">
            <column name="custom_page_title_tag" type="varchar2(512)"/>
            <column name="custom_page_h1_heading" type="varchar2(100)"/>
        </addColumn>
     </changeSet>

  	<changeSet author="schen" id="14">
       <addColumn tableName="bc_promcnt_xlate">
            <column name="image_url" type="varchar2(254)"/>
        </addColumn>
     </changeSet>

    
     <!-- update Property Mapping from displayName to displayNameDefault for i18n -->
     <changeSet author="schen" id="15">
 		<sql>
 		update vmap_ivm2pvm_rel set name='displayNameDefault' where IVM_ID='AmIvmCatGen' and PVM_ID='BcPvmCategoryName';
 		</sql>
 	</changeSet>

    <changeSet author="schen" id="16">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="bc_message_xlate" columnName="message_value"/>
        </preConditions>
        <modifyDataType tableName="bc_message_xlate" columnName="message_value" newDataType="varchar2(4000)"/>
    </changeSet>
     
    <!-- Add field to store nav menu flyout template based on category context -->
	<changeSet author="kirving" id="37">
	    <preConditions onFail="MARK_RAN">
	      <not><columnExists tableName="bc_category" columnName="flyout_template_id"/></not>
	    </preConditions>
 		<addColumn tableName="bc_category">
			<column name="flyout_template_id" type="varchar2(40)"/>
 		</addColumn>
 	</changeSet>

	<changeSet author="kkhaliqi" id="50">	
    <preConditions onFail="MARK_RAN">
      <not><columnExists tableName="bc_cat_xlate" columnName="translation_name"/></not>
      <not><columnExists tableName="bc_binfo_xlate" columnName="translation_name"/></not>
      <not><columnExists tableName="bc_promcnt_xlate" columnName="translation_name"/></not>
      <not><columnExists tableName="bc_content_xlate" columnName="translation_name"/></not>
      <not><columnExists tableName="bc_message_xlate" columnName="translation_name"/></not>
    </preConditions>
    <comment>
		add searchable field for bcc managed translation assets
    </comment>
    <addColumn tableName="bc_cat_xlate">
      <column name="translation_name" type="varchar2(255)"/>
    </addColumn>	
    <addColumn tableName="bc_binfo_xlate">
      <column name="translation_name" type="varchar2(255)"/>
    </addColumn>
    <addColumn tableName="bc_promcnt_xlate">
      <column name="translation_name" type="varchar2(255)"/>
    </addColumn>
    <addColumn tableName="bc_content_xlate">
      <column name="translation_name" type="varchar2(255)"/>
    </addColumn>
    <addColumn tableName="bc_message_xlate">
      <column name="translation_name" type="varchar2(255)"/>
    </addColumn>            
	</changeSet>     	

    <changeSet author="rmerizalde" id="15">
      <insert tableName="vmap_ivm2pvm_rel">
        <column name="ivm_id" value="AmIvmDef"/>
        <column name="pvm_id" value="BcPvmFastColl"/>
        <column name="name" value="conditions"/>
     </insert>
    </changeSet> 

    <changeSet author="kkhaliqi" id="32">
      <preConditions onFail="MARK_RAN">
              <not><tableExists tableName="bc_tagging_tool_tags_locales" /></not>
      </preConditions>
      <createTable tableName="bc_tagging_tool_tags_locales">
              <column name="tag_id" type="VARCHAR2(40 BYTE)">
                      <constraints nullable="false" />
              </column>
              <column name="locale_id" type="VARCHAR2(40 BYTE)">
                      <constraints nullable="false" />
              </column>
              <column name="asset_version" type="NUMBER(19)">
                      <constraints nullable="false" />
              </column>
              <column name="sec_asset_version" type="NUMBER(19)">
                      <constraints nullable="false" />
              </column>
      </createTable>
      <addPrimaryKey tableName="bc_tagging_tool_tags_locales"
              columnNames="tag_id,asset_version,sec_asset_version" constraintName="tag_tool_tag_locales_pk" />
    </changeSet>

 	<changeSet author="schen" id="17">	
	    <preConditions onFail="MARK_RAN">
	      <columnExists tableName="bc_tagging_tool_tags_locales" columnName="sec_asset_version"/>
	    </preConditions>
	    <comment>
			drop column sec_asset_version from bc_tagging_tool_tags_locales, and recreate the primary key
	    </comment>
	    <dropPrimaryKey tableName="bc_tagging_tool_tags_locales" constraintName="tag_tool_tag_locales_pk"/>
	    <dropColumn tableName="bc_tagging_tool_tags_locales" columnName="sec_asset_version"/>
	    <addPrimaryKey tableName="bc_tagging_tool_tags_locales" columnNames="tag_id,locale_id,asset_version" constraintName="tag_tool_tag_locales_pk" />
 	</changeSet>
 	
 	<changeSet author="schen" id="18">
		<preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from bc_tagging_tool_tags_locales</sqlCheck>
        </preConditions>

  		<sql>
		insert into bc_tagging_tool_tags_locales(tag_id, locale_id, asset_version) select dtag_id, 'en_US', dasset_version from (select tag_id as dtag_id,asset_version as dasset_version from bc_tagging_tool_tag where is_head=1);
 		</sql>
 	</changeSet>  

    <changeSet author="kkhaliqi" id="33">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="bc_shipping_method_ranges" columnName="store_id" /></not>
        </preConditions>
        <addColumn tableName="bc_shipping_method_ranges">
            <column name="store_id" type="varchar2(10)" defaultValue="US"/>
        </addColumn>
    </changeSet>
     	
  
    <include file="commercesearch/liquibase-pub-changelog.xml" relativeToChangelogFile="true" />

	<!-- tables to add before running core changes -->

	<!-- add this here so the non-versioned definition is skipped when running the core changelog -->

    <!-- NOTE: these should always run LAST, insert your changes above this -->
    <!-- Synonyms for unversioned data from pub to preview -->
    <include file="includes/synonyms.xml" relativeToChangelogFile="true" />

    <!-- Add all core changes to publishing first -->
    <include file="liquibase-core-changelog.xml" relativeToChangelogFile="true" />  

</databaseChangeLog>
