<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">


  <changeSet author="commercesearch" id="1">
    <preConditions onFail="MARK_RAN">
      <not><tableExists tableName="cs_synonym_list"/></not>
      <not><tableExists tableName="cs_syn_list_mapping"/></not>
      <not><tableExists tableName="cs_synonym"/></not>
    </preConditions>

    <createTable tableName="cs_synonym_list">
      <column name="syn_list_id" type="VARCHAR2(40 BYTE)">
        <constraints nullable="false"/>
      </column>
      <column name="name" type="VARCHAR2(30 BYTE)">
        <constraints nullable="false" />
      </column>
      <column name="asset_version" type="NUMBER(19)">
        <constraints nullable="false"/>
      </column>
      <column name="workspace_id" type="VARCHAR2(40)">
        <constraints nullable="false"/>
      </column>
      <column name="branch_id" type="VARCHAR2(40)">
        <constraints nullable="false"/>
      </column>
      <column name="is_head" type="NUMBER(1)">
        <constraints nullable="false"/>
      </column>
      <column name="version_deleted" type="NUMBER(1)">
        <constraints nullable="false"/>
      </column>
      <column name="version_editable" type="NUMBER(1)">
        <constraints nullable="false"/>
      </column>
      <column name="pred_version" type="NUMBER(19)"/>
      <column name="checkin_date" type="TIMESTAMP"/>      
    </createTable>
    <addPrimaryKey tableName="cs_synonym_list" columnNames="syn_list_id,asset_version" constraintName="cs_syn_list_pk"/>

    <createTable tableName="cs_syn_list_mapping">
       <column name="syn_list_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false"/>
       </column>
       <column name="syn_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false"/>
       </column>
       <column name="asset_version" type="NUMBER(19)">
            <constraints nullable="false"/>
       </column>
    </createTable>
    <addPrimaryKey tableName="cs_syn_list_mapping" columnNames="syn_list_id,syn_id,asset_version" constraintName="cs_syn_list_map_pk"/>

    <createTable tableName="cs_synonym">
      <column name="syn_id" type="VARCHAR2(40 BYTE)">
        <constraints nullable="false"/>
      </column>
      <column name="mapping" type="VARCHAR2(512 BYTE)">
        <constraints nullable="false"/>
      </column>
      <column name="asset_version" type="NUMBER(19)">
        <constraints nullable="false"/>
      </column>
      <column name="workspace_id" type="VARCHAR2(40)">
        <constraints nullable="false"/>
      </column>
      <column name="branch_id" type="VARCHAR2(40)">
        <constraints nullable="false"/>
      </column>
      <column name="is_head" type="NUMBER(1)">
        <constraints nullable="false"/>
      </column>
      <column name="version_deleted" type="NUMBER(1)">
        <constraints nullable="false"/>
      </column>
      <column name="version_editable" type="NUMBER(1)">
        <constraints nullable="false"/>
      </column>
      <column name="pred_version" type="NUMBER(19)"/>
      <column name="checkin_date" type="TIMESTAMP"/>
    </createTable>
    <addPrimaryKey tableName="cs_synonym" columnNames="syn_id,asset_version" constraintName="cs_synonym_pk"/>
  </changeSet>

  <changeSet author="commercesearch" id="2">
    <preConditions onFail="MARK_RAN">
        <sqlCheck expectedResult="0">        
        SELECT COUNT(*)
            FROM vmap_pv
            WHERE id='EsPvSynonymMapping'
        </sqlCheck>
    </preConditions>
    <!-- Property View for Synonym's mapping property -->
    <insert tableName="vmap_pv">
        <column name="id" value="EsPvSynonymMapping"/>
        <column name="name" value="Synonym Mapping Editor"/>
        <column name="type" value="string"/>
        <column name="component_type" value=""/>
        <column name="description" value="Synonym Mapping Editor"/>
        <column name="uri" value=""/>
        <column name="view_component" value="atg.assetmanager.editor.view.property.DefaultEditor"/>
        <column name="app_name" value="Commerce Search"/>
        <column name="mode_id" value="AmMmDef"/>
        <column name="container_family" value=""/>
        <column name="is_default" valueNumeric="0"/>
        <column name="is_readonly" valueNumeric="0"/>
        <column name="is_component" valueNumeric="0"/>
    </insert>

    <!-- Define Property View attributes -->
    <insert tableName="vmap_pvattrdef">
        <column name="id" value="EsPvAdDefSynonymMappingPropSvc"/>
        <column name="description" value=""/>
        <column name="default_value" value="/org/commercesearch/remote/assetmanager/editor/service/SynonymMappingAssetService"/>
    </insert>

    <insert tableName="vmap_pvattrdef">
        <column name="id" value="EsPvAdSynonymMappingResBund"/>
        <column name="description" value=""/>
        <column name="default_value" value="atg.remote.commerce.Resources"/>
    </insert>

    <!-- linke Propevety VIew attributes to Property View -->
    <insert tableName="vmap_pv2pvad_rel">
      <column name="view_id" value="EsPvSynonymMapping"/>
      <column name="attr_id" value="EsPvAdDefSynonymMappingPropSvc"/>
      <column name="name" value="customAssetPropertyService"/>
    </insert>

    <insert tableName="vmap_pv2pvad_rel">
      <column name="view_id" value="EsPvSynonymMapping"/>
      <column name="attr_id" value="EsPvAdSynonymMappingResBund"/>
      <column name="name" value="resourceBundle"/>
    </insert>

    <!-- Property View Mapping for Synonym's Mapping property -->
    <insert tableName="vmap_pvm">
      <column name="id" value="EsPvmSynonymMapping"/>
      <column name="description" value="Synonym Mapping Editor Property Mapping"/>
      <column name="pview_id" value="EsPvSynonymMapping"/>
      <column name="cpview_id" value=""/>
    </insert>

    <!-- Item View Mapping -->
    <insert tableName="vmap_ivm">
      <column name="id" value="EsIvmSynonymMapping"/>
      <column name="name" value="SynonymMapping"/>
      <column name="display_name" value="EsIvmSynonymMapping.displayName"/>
      <column name="view_id" value="AmIvDef"/>
      <column name="description" value="Synonym Mapping"/>
    </insert>

    <!-- Define Property View Mapping attributes -->
    <insert tableName="vmap_attrval">
      <column name="id" value="EsAvSynonymAdvProp"/>
      <column name="attr_value" value="false"/>
    </insert>

    <insert tableName="vmap_attrval">
      <column name="id" value="EsAvSynonymBnd"/>
      <column name="attr_value" value="org.commercesearch.ca.BCCResources"/>
    </insert>

    <!-- Linke Property View Mapping attributes -->
    <insert tableName="vmap_attrval_rel">
      <column name="mapper_id" value="EsIvmSynonymMapping"/>
      <column name="attribute_id" value="EsAvSynonymAdvProp"/>
      <column name="name" value="includeNewProperties"/>
    </insert>

    <insert tableName="vmap_attrval_rel">
      <column name="mapper_id" value="EsImSynonymMapping"/>
      <column name="attribute_id" value="EsAvSynonymBnd"/>
      <column name="name" value="resourceBundle"/>
    </insert>

    <!-- Link Item View Mapping with Property VIew Mapping -->
    <insert tableName="vmap_ivm2pvm_rel">
      <column name="ivm_id" value="EsIvmSynonymMapping"/>
      <column name="pvm_id" value="EsPvmSynonymMapping"/>
      <column name="name" value="mapping"/>
    </insert>

    <!-- Item Mapping -->
    <insert tableName="vmap_im">
      <column name="id" value="EsImSynonymMapping"/>
      <column name="name" value="AssetManager"/>
      <column name="item_path" value="/org/commercesearch/repository/SearchRepository"/>
      <column name="item_name" value="synonym"/>
      <column name="is_readonly" value=""/>
      <column name="form_handler" value="AmFhDef"/>
      <column name="mode_id" value="AmMmDef"/>
      <column name="description" value="Synonym Mapping Item Mapping"/>
    </insert>

    <!-- Link Item Mapping to Item View Mapping -->
    <insert tableName="vmap_im2ivm_rel">
      <column name="item_id" value="EsImSynonymMapping"/>
      <column name="sequence_num" value="0"/>
      <column name="view_id" value="EsIvmSynonymMapping"/>
    </insert>
  </changeSet>

  <changeSet author="commercesearch" id="3">
    <preConditions onFail="MARK_RAN">
      <not><tableExists tableName="cs_rule"/></not>
      <not><tableExists tableName="cs_rule_cats"/></not>
    </preConditions>

    <createTable tableName="cs_rule">
      <column name="rule_id" type="VARCHAR2(40 BYTE)">
        <constraints nullable="false"/>
      </column>
      <column name="type" type="VARCHAR2(10 BYTE)">
        <constraints nullable="false" />
      </column>
      <column name="name" type="VARCHAR2(30 BYTE)">
        <constraints nullable="false" />
      </column>
      <column name="query" type="VARCHAR2(100 BYTE)">
        <constraints nullable="false" />
      </column>      
      <column name="start_date" type="Date">
        <constraints nullable="true" />
      </column>
      <column name="end_date" type="Date">
        <constraints nullable="true" />
      </column>
      <column name="asset_version" type="NUMBER(19)">
        <constraints nullable="false"/>
      </column>
      <column name="workspace_id" type="VARCHAR2(40)">
        <constraints nullable="false"/>
      </column>
      <column name="branch_id" type="VARCHAR2(40)">
        <constraints nullable="false"/>
      </column>
      <column name="is_head" type="NUMBER(1)">
        <constraints nullable="false"/>
      </column>
      <column name="version_deleted" type="NUMBER(1)">
        <constraints nullable="false"/>
      </column>
      <column name="version_editable" type="NUMBER(1)">
        <constraints nullable="false"/>
      </column>
      <column name="pred_version" type="NUMBER(19)"/>
      <column name="checkin_date" type="TIMESTAMP"/>
    </createTable>
    <addPrimaryKey tableName="cs_rule" columnNames="rule_id,asset_version" constraintName="cs_rule_pk"/>

    <createTable tableName="cs_rule_sites">
      <column name="rule_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false"/>
      </column>
      <column name="site_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false"/>
      </column>
      <column name="asset_version" type="NUMBER(19)">
            <constraints nullable="false"/>
       </column>
    </createTable>
    <addPrimaryKey tableName="cs_rule_sites" columnNames="rule_id,site_id,asset_version" constraintName="cs_rule_sites_pk"/>     

    <createTable tableName="cs_rule_catalogs">
      <column name="rule_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false"/>
      </column>
      <column name="catalog_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false"/>
      </column>
      <column name="asset_version" type="NUMBER(19)">
            <constraints nullable="false"/>
       </column>
    </createTable>
    <addPrimaryKey tableName="cs_rule_catalogs" columnNames="rule_id,catalog_id,asset_version" constraintName="cs_rule_catalogs_pk"/>    

    <createTable tableName="cs_rule_cats">
      <column name="rule_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false"/>
      </column>
      <column name="category_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false"/>
      </column>
      <column name="asset_version" type="NUMBER(19)">
            <constraints nullable="false"/>
       </column>
    </createTable>
    <addPrimaryKey tableName="cs_rule_cats" columnNames="rule_id,category_id,asset_version" constraintName="cs_rule_cats_pk"/>
  </changeSet>

  <changeSet author="commercesearch" id="4">
    <preConditions onFail="MARK_RAN">
      <not><tableExists tableName="cs_boost_rule"/></not>
      <not><tableExists tableName="cs_boost_rule_prods"/></not>
    </preConditions>

    <createTable tableName="cs_boost_rule">
      <column name="rule_id" type="VARCHAR2(40 BYTE)">
        <constraints nullable="false" />
       </column>
      <column name="asset_version" type="NUMBER(19)">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addPrimaryKey tableName="cs_boost_rule" columnNames="rule_id,asset_version" constraintName="cs_boost_rule_pk"/>

    <createTable tableName="cs_boost_rule_prods">
      <column name="rule_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false" />
      </column>
      <column name="seq_num" type="INTEGER">
        <constraints nullable="false" />
      </column>
      <column name="product_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false" />
      </column>
      <column name="asset_version" type="NUMBER(19)">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addPrimaryKey tableName="cs_boost_rule_prods" columnNames="rule_id,product_id,asset_version" constraintName="cs_boost_rule_prod_pk"/>

    <createTable tableName="cs_block_rule">
      <column name="rule_id" type="VARCHAR2(40 BYTE)">
        <constraints nullable="false" />
       </column>
      <column name="asset_version" type="NUMBER(19)">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addPrimaryKey tableName="cs_block_rule" columnNames="rule_id,asset_version" constraintName="cs_block_rule_pk"/>

    <createTable tableName="cs_block_rule_prods">
      <column name="rule_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false" />
      </column>
      <column name="product_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false" />
      </column>
      <column name="asset_version" type="NUMBER(19)">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addPrimaryKey tableName="cs_block_rule_prods" columnNames="rule_id,product_id,asset_version" constraintName="cs_block_rule_prod_pk"/>    
  </changeSet>

  <changeSet author="commercesearch" id="5">
    <preConditions onFail="MARK_RAN">
      <not><tableExists tableName="cs_facet"/></not>
      <not><tableExists tableName="cs_field_facet"/></not>
    </preConditions>

    <createTable tableName="cs_facet">
      <column name="facet_id" type="VARCHAR2(40 BYTE)">
        <constraints nullable="false"/>
      </column>
      <column name="type" type="VARCHAR2(10 BYTE)">
        <constraints nullable="false" />
      </column>
      <column name="name" type="VARCHAR2(30 BYTE)">
        <constraints nullable="false" />
      </column>
      <column name="is_multi_select" type="NUMBER(1)">
        <constraints nullable="true" />
      </column>
      <column name="asset_version" type="NUMBER(19)">
        <constraints nullable="false"/>
      </column>
      <column name="workspace_id" type="VARCHAR2(40)">
        <constraints nullable="false"/>
      </column>
      <column name="branch_id" type="VARCHAR2(40)">
        <constraints nullable="false"/>
      </column>
      <column name="is_head" type="NUMBER(1)">
        <constraints nullable="false"/>
      </column>
      <column name="version_deleted" type="NUMBER(1)">
        <constraints nullable="false"/>
      </column>
      <column name="version_editable" type="NUMBER(1)">
        <constraints nullable="false"/>
      </column>
      <column name="pred_version" type="NUMBER(19)"/>
      <column name="checkin_date" type="TIMESTAMP"/>
    </createTable>
    <addPrimaryKey tableName="cs_facet" columnNames="facet_id,asset_version" constraintName="cs_facet_pk"/>

    <createTable tableName="cs_field_facet">
      <column name="facet_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false"/>
      </column>
      <column name="field_name" type="VARCHAR2(30 BYTE)">
        <constraints nullable="false" />
      </column>
      <column name="sort" type="VARCHAR2(10 BYTE)">
        <constraints nullable="true" />
      </column>
      <column name="limit" type="INTEGER">
        <constraints nullable="true" />
      </column>
      <column name="min_count" type="INTEGER">
        <constraints nullable="true" />
      </column>
      <column name="missing" type="NUMBER(1)">
        <constraints nullable="true" />
      </column>
      <column name="prefix" type="VARCHAR2(100 BYTE)">
        <constraints nullable="true" />
      </column>
      <column name="method" type="VARCHAR2(10 BYTE)">
        <constraints nullable="true" />
      </column>
      <column name="min_df" type="INTEGER">
        <constraints nullable="true" />
      </column>
      <column name="asset_version" type="NUMBER(19)">
        <constraints nullable="false"/>
      </column>      
    </createTable>
    <addPrimaryKey tableName="cs_field_facet" columnNames="facet_id,asset_version" constraintName="cs_field_facet_pk"/>
  </changeSet>

  <changeSet author="commercesearch" id="6">
    <preConditions onFail="MARK_RAN">
      <not><tableExists tableName="cs_facet_rule"/></not>
      <not><tableExists tableName="cs_facet_rule_facets"/></not>
    </preConditions>

    <createTable tableName="cs_facet_rule">
      <column name="rule_id" type="VARCHAR2(40 BYTE)">
        <constraints nullable="false"/>
      </column>
      <column name="asset_version" type="NUMBER(19)">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addPrimaryKey tableName="cs_facet_rule" columnNames="rule_id,asset_version" constraintName="cs_facet_rule_pk"/>

    <createTable tableName="cs_facet_rule_facets">
      <column name="rule_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false" />
      </column>
      <column name="facet_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false" />
      </column>
      <column name="asset_version" type="NUMBER(19)">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addPrimaryKey tableName="cs_facet_rule_facets" columnNames="rule_id,facet_id,asset_version" constraintName="cs_facet_rule_facet_pk"/>
  </changeSet>

  <changeSet author="commercesearch" id="7">
    <preConditions onFail="MARK_RAN">
      <not><tableExists tableName="cs_range_facet"/></not>
      <not><tableExists tableName="cs_date_facet"/></not>
    </preConditions>
    <createTable tableName="cs_range_facet">
      <column name="facet_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false" />
      </column>
      <column name="field_name" type="VARCHAR2(30 BYTE)">
        <constraints nullable="false" />
      </column>
      <column name="range_start" type="INTEGER">
        <constraints nullable="false" />
      </column>
      <column name="range_end" type="INTEGER">
        <constraints nullable="false" />
      </column>
      <column name="range_gap" type="INTEGER">
        <constraints nullable="false" />
      </column>
      <column name="hardened" type="NUMBER(1)">
        <constraints nullable="true" />
      </column>
      <column name="asset_version" type="NUMBER(19)">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addPrimaryKey tableName="cs_range_facet" columnNames="facet_id,asset_version" constraintName="cs_range_facet_pk"/>

    <createTable tableName="cs_date_facet">
      <column name="facet_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false" />
      </column>
      <column name="field_name" type="VARCHAR2(30 BYTE)">
        <constraints nullable="false" />
      </column>
      <column name="range_start" type="Date">
        <constraints nullable="false" />
      </column>
      <column name="range_end" type="Date">
        <constraints nullable="false" />
      </column>
      <column name="range_gap" type="VARCHAR2(100 BYTE)">
        <constraints nullable="false" />
      </column>
      <column name="hardened" type="NUMBER(1)">
        <constraints nullable="true" />
      </column>
      <column name="asset_version" type="NUMBER(19)">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addPrimaryKey tableName="cs_date_facet" columnNames="facet_id,asset_version" constraintName="cs_date_facet_pk"/>
  </changeSet>

  <changeSet author="commercesearch" id="8">
    <preConditions onFail="MARK_RAN">
      <not><tableExists tableName="cs_query_facet"/></not>
      <not><tableExists tableName="cs_query_facet_queries"/></not>
    </preConditions>
    <createTable tableName="cs_query_facet">
      <column name="facet_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false" />
      </column>
      <column name="field_name" type="VARCHAR2(30 BYTE)">
        <constraints nullable="false" />
      </column>
      <column name="asset_version" type="NUMBER(19)">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addPrimaryKey tableName="cs_query_facet" columnNames="facet_id,asset_version" constraintName="cs_query_facet_pk"/>

    <createTable tableName="cs_query_facet_queries">
      <column name="facet_id" type="VARCHAR2(40 BYTE)">
          <constraints nullable="false"/>
      </column>
      <column name="seq_num" type="INTEGER">
        <constraints nullable="false" />
      </column>
      <column name="query" type="VARCHAR2(200 BYTE)">
        <constraints nullable="false" />
      </column>
      <column name="asset_version" type="NUMBER(19)">
        <constraints nullable="false"/>
      </column>
    </createTable>
    <addPrimaryKey tableName="cs_query_facet_queries" columnNames="facet_id,seq_num,asset_version" constraintName="cs_query_facet_queries_pk"/>
  </changeSet>
  
  <changeSet author="commercesearch" id="9">
    <preConditions onFail="MARK_RAN">
      <not><tableExists tableName="cs_redirect_rule"/></not>
    </preConditions>
    <createTable tableName="cs_redirect_rule">
       <column name="rule_id" type="VARCHAR2(40 BYTE)">
         <constraints nullable="false" />
       </column>
       <column name="asset_version" type="NUMBER(19)">
         <constraints nullable="false"/>
       </column>
       <column name="url" type="VARCHAR2(200 BYTE)">
         <constraints nullable="false" />
       </column>
    </createTable>
    <addPrimaryKey tableName="cs_redirect_rule" columnNames="rule_id,asset_version" constraintName="cs_redirect_rule_pk"/>
  </changeSet>
</databaseChangeLog>
